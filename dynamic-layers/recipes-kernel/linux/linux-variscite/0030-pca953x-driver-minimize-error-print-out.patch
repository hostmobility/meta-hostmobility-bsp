From a78810bb9b02f653d31a3acca42654523cf69e9d Mon Sep 17 00:00:00 2001
From: rikardo <rikard.olander@hostmobility.com>
Date: Mon, 21 Aug 2023 11:49:25 +0000
Subject: [PATCH 1/1] pca953x driver minimize error print out

---
 drivers/gpio/gpio-pca953x.c | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/drivers/gpio/gpio-pca953x.c b/drivers/gpio/gpio-pca953x.c
index 1b7f050b4f29..41fdcc018fbb 100644
--- a/drivers/gpio/gpio-pca953x.c
+++ b/drivers/gpio/gpio-pca953x.c
@@ -408,6 +408,8 @@ static int pca953x_write_regs(struct pca953x_chip *chip, int reg, unsigned long
 
 	return 0;
 }
+// HACK: We dont want the chip to send to much error message when the HMX unit goes to super cap mode(shutdown with no power to the board)
+static int error_count = 0;
 
 static int pca953x_read_regs(struct pca953x_chip *chip, int reg, unsigned long *val)
 {
@@ -416,10 +418,14 @@ static int pca953x_read_regs(struct pca953x_chip *chip, int reg, unsigned long *
 	int i, ret;
 
 	ret = regmap_bulk_read(chip->regmap, regaddr, value, NBANK(chip));
-	if (ret < 0) {
+	if (ret < 0) {	
+	if (error_count == 0) {
 		dev_err(&chip->client->dev, "failed reading register\n");
 		return ret;
 	}
+		error_count = (error_count + 1) % 100; // wrapping around at 100
+		return 0;
+	}
 
 	for (i = 0; i < NBANK(chip); i++)
 		bitmap_set_value8(val, value[i], i * BANK_SZ);
-- 
2.34.1

