From 4303392c00214f93422c3272798e27d30ff3fc28 Mon Sep 17 00:00:00 2001
From: rikardo <rikard.olander@hostmobility.com>
Date: Thu, 8 Feb 2024 13:45:34 +0000
Subject: [PATCH 1/1] fix missing operating-points-v2 for mmc 4 and 2

---
 .../arm/boot/dts/tegra30-peripherals-opp.dtsi | 36 +++++++++++++++++++
 arch/arm/boot/dts/tegra30.dtsi                |  2 ++
 2 files changed, 38 insertions(+)

diff --git a/arch/arm/boot/dts/tegra30-peripherals-opp.dtsi b/arch/arm/boot/dts/tegra30-peripherals-opp.dtsi
index d100a1a8b705..0790d30963eb 100644
--- a/arch/arm/boot/dts/tegra30-peripherals-opp.dtsi
+++ b/arch/arm/boot/dts/tegra30-peripherals-opp.dtsi
@@ -1575,6 +1575,24 @@ opp-208000000-1200 {
 		};
 	};
 
+	sdmmc2_dvfs_opp_table: opp-table-sdmmc2 {
+		compatible = "operating-points-v2";
+
+		opp-104000000-950 {
+			opp-microvolt = <950000 950000 1350000>;
+			opp-hz = /bits/ 64 <104000000>;
+			opp-supported-hw = <0x000F>;
+			required-opps = <&core_opp_950>;
+		};
+
+		opp-208000000-1200 {
+			opp-microvolt = <1200000 1200000 1350000>;
+			opp-hz = /bits/ 64 <208000000>;
+			opp-supported-hw = <0x000F>;
+			required-opps = <&core_opp_1200>;
+		};
+	};
+
 	sdmmc3_dvfs_opp_table: opp-table-sdmmc3 {
 		compatible = "operating-points-v2";
 
@@ -1593,6 +1611,24 @@ opp-208000000-1200 {
 		};
 	};
 
+	sdmmc4_dvfs_opp_table: opp-table-sdmmc4 {
+		compatible = "operating-points-v2";
+
+		opp-104000000-950 {
+			opp-microvolt = <950000 950000 1350000>;
+			opp-hz = /bits/ 64 <104000000>;
+			opp-supported-hw = <0x000F>;
+			required-opps = <&core_opp_950>;
+		};
+
+		opp-208000000-1200 {
+			opp-microvolt = <1200000 1200000 1350000>;
+			opp-hz = /bits/ 64 <208000000>;
+			opp-supported-hw = <0x000F>;
+			required-opps = <&core_opp_1200>;
+		};
+	};
+
 	usbd_dvfs_opp_table: opp-table-usbd {
 		compatible = "operating-points-v2";
 
diff --git a/arch/arm/boot/dts/tegra30.dtsi b/arch/arm/boot/dts/tegra30.dtsi
index 9dab8d2c158a..e79900cdeef8 100644
--- a/arch/arm/boot/dts/tegra30.dtsi
+++ b/arch/arm/boot/dts/tegra30.dtsi
@@ -1085,6 +1085,7 @@ mmc@78000200 {
 		clock-names = "sdhci";
 		resets = <&tegra_car 9>;
 		reset-names = "sdhci";
+		operating-points-v2 = <&sdmmc2_dvfs_opp_table>;
 		status = "disabled";
 	};
 
@@ -1108,6 +1109,7 @@ mmc@78000600 {
 		clocks = <&tegra_car TEGRA30_CLK_SDMMC4>;
 		clock-names = "sdhci";
 		resets = <&tegra_car 15>;
+		operating-points-v2 = <&sdmmc4_dvfs_opp_table>;
 		reset-names = "sdhci";
 		status = "disabled";
 	};
-- 
2.34.1

